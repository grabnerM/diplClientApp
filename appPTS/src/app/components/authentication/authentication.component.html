<ion-header>
    <ion-toolbar color="primary">
        <ion-title>Pantum</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

    <ion-card>
        <ion-card-header>
            <ion-toolbar>
                <ion-segment color="tertiary" scrollable mode="md" [(ngModel)]="segmentModel" value="login" (ionChange)="segmentChanged($event)">
                    <ion-segment-button value="login">
                        <ion-label>Login</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="register">
                        <ion-label>Register</ion-label>
                    </ion-segment-button>
                </ion-segment>
            </ion-toolbar>
        </ion-card-header>

        <ion-card-content *ngIf="segmentModel == 'login'">
            <form [formGroup]="loginPage">
                <ion-item lines="none">
                    <ion-label position="stacked">Email</ion-label>
                    <ion-input formControlName="lEmail" type="email" placeholder="Email" name="email"></ion-input>
                </ion-item>

                <ion-item lines="none">
                    <ion-label position="stacked">Password</ion-label>
                    <ion-input formControlName="lPassword" type="password" placeholder="Password" name="password"></ion-input>
                </ion-item>

                <ion-button (click)="login()" [disabled]="!loginPage.valid" expand="block">Login</ion-button>
            </form>
            <p (click)="goToReceiverLogin()">
                Als ÄÄÄÄÄÄH anmelden.
            </p>
        </ion-card-content>

        <ion-card-content *ngIf="segmentModel == 'register'">
            <form [formGroup]="registerFirstPage" *ngIf="!secondPage">
                <ion-item lines="none">
                    <ion-label position="stacked">
                        Username
                        <span *ngIf="formInputIsRequired('username')" class="required">&#42;</span>
                    </ion-label>
                    <ion-input formControlName="username" type="text" placeholder="Username" name="uname"></ion-input>
                </ion-item>

                <div *ngIf="registerFirstPage.controls.username.pending">
                    <p>Checking username...</p>
                </div>

                <div *ngIf="!registerFirstPage.controls.username.valid && !registerFirstPage.controls.username.pending && registerFirstPage.controls.username.dirty">
                    Sorry, that username can not be used!
                </div>

                <ion-item lines="none">
                    <ion-label position="stacked">
                        Firstname
                    </ion-label>
                    <ion-input formControlName="firstname" type="text" placeholder="Firstname" name="fname"></ion-input>
                </ion-item>

                <div *ngIf="!registerFirstPage.controls.firstname.valid && !registerFirstPage.controls.firstname.pending && registerFirstPage.controls.firstname.dirty">
                    Sorry, that username can not be used!
                </div>

                <ion-item lines="none">
                    <ion-label position="stacked">
                        Lastname
                    </ion-label>
                    <ion-input formControlName="lastname" type="text" placeholder="Lastname" name="lname"></ion-input>
                </ion-item>

                <div *ngIf="!registerFirstPage.controls.lastname.valid && !registerFirstPage.controls.lastname.pending && registerFirstPage.controls.lastname.dirty">
                    Sorry, that username can not be used!
                </div>

                <ion-item lines="none">
                    <ion-label position="stacked">
                        Password
                    </ion-label>
                    <ion-input formControlName="rPassword" type="password" placeholder="Password" name="pwd"></ion-input>
                </ion-item>

                <div *ngIf="!registerFirstPage.controls.rPassword.valid  && registerFirstPage.controls.rPassword.dirty">
                    Please enter a valid password.
                </div>

                <ion-item lines="none">
                    <ion-label position="stacked">
                        Confirm Password
                    </ion-label>
                    <ion-input formControlName="cPassword" type="password" placeholder="Confirm Password" name="cPwd"></ion-input>
                </ion-item>

                <div *ngIf="registerFirstPage.controls.cPassword.errors?.mustMatch && registerFirstPage.controls.cPassword.dirty">
                    Passwords must match!
                </div>

                <ion-item lines="none">
                    <ion-label position="stacked">Sex</ion-label>
                    <ion-select formControlName="sex" placeholder="Please select gender">
                        <ion-select-option value="m">Male</ion-select-option>
                        <ion-select-option value="f">Female</ion-select-option>
                        <ion-select-option value="d">Diverse</ion-select-option>
                    </ion-select>
                </ion-item>

                <ion-button type="submit" [disabled]="!registerFirstPage.valid" expand="block" (click)="next()">Next</ion-button>
            </form>

            <form [formGroup]="registerSecondPage" *ngIf="secondPage">
                <ion-item lines="none">
                    <ion-label position="stacked">
                        E-Mail
                    </ion-label>
                    <ion-input formControlName="rEmail" type="mail" placeholder="E-Mail" name="mail"></ion-input>
                </ion-item>

                <ion-item lines="none">
                    <ion-label position="stacked">
                        Confirm E-Mail
                    </ion-label>
                    <ion-input formControlName="cEmail" type="mail" placeholder="Confirm E-Mail" name="cMail"></ion-input>

                    <div *ngIf="registerSecondPage.controls.cEmail.errors?.mustMatch && registerSecondPage.controls.cEmail.dirty">
                        Emails must match!
                    </div>

                    <div *ngIf="registerSecondPage.controls.cEmail.errors?.pattern">
                        Fick dich du dummer Wichser
                    </div>
                </ion-item>

                <ion-grid>
                    <ion-row>
                        <ion-col size="8">
                            <ion-item lines="none">
                                <ion-label position="stacked">
                                    City
                                </ion-label>
                                <ion-input formControlName="city" type="text" placeholder="City" name="city"></ion-input>
                            </ion-item>
                        </ion-col>
                        <ion-col size="4">
                            <ion-item lines="none">
                                <ion-label position="stacked">
                                    Zip
                                </ion-label>
                                <ion-input formControlName="zip" type="number" placeholder="Zip" name="zip"></ion-input>
                            </ion-item>
                        </ion-col>
                    </ion-row>
                    <ion-row>
                        <ion-col size="8">
                            <ion-item lines="none">
                                <ion-label position="stacked">
                                    Street
                                </ion-label>
                                <ion-input formControlName="street" type="text" placeholder="Street" name="street"></ion-input>
                            </ion-item>
                        </ion-col>
                        <ion-col size="4">
                            <ion-item lines="none">
                                <ion-label position="stacked">
                                    Housenr.
                                </ion-label>
                                <ion-input formControlName="housenr" type="text" placeholder="Housenr." name="housenumber"></ion-input>
                            </ion-item>
                        </ion-col>
                    </ion-row>
                </ion-grid>

                <ion-button type="submit" [disabled]="!registerSecondPage.valid" expand="block" (click)="register()">Register</ion-button>
            </form>

        </ion-card-content>
    </ion-card>

</ion-content>